import{s as z,d as C,p as P}from"./styles-9a916d00-Dy9m_1IX.js";import{D as d,w as c,B as k,$ as q,S as F,O as A,T as I,U as M,R}from"./index-3KCn1nHi.js";import{G as H}from"./graph-DsSUqKEo.js";import{r as U}from"./index-3862675e-BiGbTJ8_.js";import"./layout-BlOhUFqC.js";import"./clone-B4emA5GV.js";import"./edges-e0da2a9e-_LjrYQvH.js";import"./createText-2e5e7dd3-DYkVba1K.js";import"./line-Bmir-uDz.js";import"./array-BKyUJesY.js";import"./path-CbwjOpE9.js";const T=s=>A.sanitizeText(s,c());let S={dividerMargin:10,padding:5,textHeight:10,curve:void 0};const V=function(s,o,f,a){const e=Object.keys(s);d.info("keys:",e),d.info(s),e.forEach(function(i){var p;var l,r;const t=s[i],y={shape:"rect",id:t.id,domId:t.domId,labelText:T(t.id),labelStyle:"",style:"fill: none; stroke: black",padding:(p=(l=c().flowchart)==null?void 0:l.padding)!=null?p:(r=c().class)==null?void 0:r.padding};o.setNode(t.id,y),B(t.classes,o,f,a,t.id),d.info("setNode",y)})},B=function(s,o,f,a,e){const i=Object.keys(s);d.info("keys:",i),d.info(s),i.filter(l=>s[l].parent==e).forEach(function(l){var x,u;var r,t;const n=s[l],y=n.cssClasses.join(" "),p=I(n.styles),m=(x=n.label)!=null?x:n.id,h=0,b={labelStyle:p.labelStyle,shape:"class_box",labelText:T(m),classData:n,rx:h,ry:h,class:y,style:p.style,id:n.id,domId:n.domId,tooltip:a.db.getTooltip(n.id,e)||"",haveCallback:n.haveCallback,link:n.link,width:n.type==="group"?500:void 0,type:n.type,padding:(u=(r=c().flowchart)==null?void 0:r.padding)!=null?u:(t=c().class)==null?void 0:t.padding};o.setNode(n.id,b),e&&o.setParent(n.id,e),d.info("setNode",b)})},W=function(s,o,f,a){d.info(s),s.forEach(function(e,i){var u;var l,r;const t=e,n="",y={labelStyle:"",style:""},p=t.text,m=0,v={labelStyle:y.labelStyle,shape:"note",labelText:T(p),noteData:t,rx:m,ry:m,class:n,style:y.style,id:t.id,domId:t.id,tooltip:"",type:"note",padding:(u=(l=c().flowchart)==null?void 0:l.padding)!=null?u:(r=c().class)==null?void 0:r.padding};if(o.setNode(t.id,v),d.info("setNode",v),!t.class||!(t.class in a))return;const b=f+i,x={id:`edgeNote${b}`,classes:"relation",pattern:"dotted",arrowhead:"none",startLabelRight:"",endLabelLeft:"",arrowTypeStart:"none",arrowTypeEnd:"none",style:"fill:none",labelStyle:"",curve:M(S.curve,R)};o.setEdge(t.id,t.class,x,b)})},J=function(s,o){const f=c().flowchart;let a=0;s.forEach(function(e){var r;var i;a++;const l={classes:"relation",pattern:e.relation.lineType==1?"dashed":"solid",id:`id_${e.id1}_${e.id2}_${a}`,arrowhead:e.type==="arrow_open"?"none":"normal",startLabelRight:e.relationTitle1==="none"?"":e.relationTitle1,endLabelLeft:e.relationTitle2==="none"?"":e.relationTitle2,arrowTypeStart:$(e.relation.type1),arrowTypeEnd:$(e.relation.type2),style:"fill:none",labelStyle:"",curve:M(f==null?void 0:f.curve,R)};if(d.info(l,e),e.style!==void 0){const t=I(e.style);l.style=t.style,l.labelStyle=t.labelStyle}e.text=e.title,e.text===void 0?e.style!==void 0&&(l.arrowheadStyle="fill: #333"):(l.arrowheadStyle="fill: #333",l.labelpos="c",((r=(i=c().flowchart)==null?void 0:i.htmlLabels)!=null?r:c().htmlLabels)?(l.labelType="html",l.label='<span class="edgeLabel">'+e.text+"</span>"):(l.labelType="text",l.label=e.text.replace(A.lineBreakRegex,`
`),e.style===void 0&&(l.style=l.style||"stroke: #333; stroke-width: 1.5px;fill:none"),l.labelStyle=l.labelStyle.replace("color:","fill:"))),o.setEdge(e.id1,e.id2,l,a)})},K=function(s){S={...S,...s}},Q=async function(s,o,f,a){var u,L,_,N;d.info("Drawing class - ",o);const e=(u=c().flowchart)!=null?u:c().class,i=c().securityLevel;d.info("config:",e);const l=(L=e==null?void 0:e.nodeSpacing)!=null?L:50,r=(_=e==null?void 0:e.rankSpacing)!=null?_:50,t=new H({multigraph:!0,compound:!0}).setGraph({rankdir:a.db.getDirection(),nodesep:l,ranksep:r,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}}),n=a.db.getNamespaces(),y=a.db.getClasses(),p=a.db.getRelations(),m=a.db.getNotes();d.info(p),V(n,t,o,a),B(y,t,o,a),J(p,t),W(m,t,p.length+1,y);let h;i==="sandbox"&&(h=k("#i"+o));const v=i==="sandbox"?k(h.nodes()[0].contentDocument.body):k("body"),b=v.select(`[id="${o}"]`),x=v.select("#"+o+" g");if(await U(x,t,["aggregation","extension","composition","dependency","lollipop"],"classDiagram",o),q.insertTitle(b,"classTitleText",(N=e==null?void 0:e.titleTopMargin)!=null?N:5,a.db.getDiagramTitle()),F(t,b,e==null?void 0:e.diagramPadding,e==null?void 0:e.useMaxWidth),!(e!=null&&e.htmlLabels)){const D=i==="sandbox"?h.nodes()[0].contentDocument:document,G=D.querySelectorAll('[id="'+o+'"] .edgeLabel .label');for(const w of G){const E=w.getBBox(),g=D.createElementNS("http://www.w3.org/2000/svg","rect");g.setAttribute("rx",0),g.setAttribute("ry",0),g.setAttribute("width",E.width),g.setAttribute("height",E.height),w.insertBefore(g,w.firstChild)}}};function $(s){let o;switch(s){case 0:o="aggregation";break;case 1:o="extension";break;case 2:o="composition";break;case 3:o="dependency";break;case 4:o="lollipop";break;default:o="none"}return o}const X={setConf:K,draw:Q},ie={parser:P,db:C,renderer:X,styles:z,init:s=>{s.class||(s.class={}),s.class.arrowMarkerAbsolute=s.arrowMarkerAbsolute,C.clear()}};export{ie as diagram};
